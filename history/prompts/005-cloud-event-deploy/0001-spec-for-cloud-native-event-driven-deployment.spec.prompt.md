---
id: 0001
title: Spec for Cloud Native Event Driven Deployment
stage: spec
date: 2026-01-07
surface: agent
model: gemini-2.0-flash-exp
feature: 005-cloud-event-deploy
branch: 005-cloud-event-deploy
user: huzaifa_nadeem
command: /sp.specify
labels: ["kafka", "dapr", "cloud", "kubernetes", "ci-cd"]
links:
  spec: specs/005-cloud-event-deploy/spec.md
  ticket: null
  adr: null
  pr: null
files:
  - specs/005-cloud-event-deploy/spec.md
  - specs/005-cloud-event-deploy/checklists/requirements.md
tests:
  - null
---

## Prompt

Phase V: Advanced Cloud-Native Event-Driven Deployment with Kafka and Dapr Project Context: Phase V (FINAL) of Evolution of Todo hackathon. Implements advanced features (recurring tasks, reminders, priorities, tags, search/filter), deploys to cloud Kubernetes (Oracle OKE or DigitalOcean DOKS), adds event-driven architecture with Kafka/Dapr, and sets up CI/CD pipeline. Target Audience: Hackathon judges evaluating production-ready architecture Enterprise teams evaluating event-driven microservices Developers learning cloud-native patterns and Dapr Intent: Build a production-grade, cloud-native, event-driven todo application with advanced features. Services communicate via Kafka events, Dapr abstracts infrastructure, recurring tasks are auto-scheduled, reminders trigger via Dapr Jobs API, and the entire system deploys to cloud Kubernetes with CI/CD. Core Features (Phase IV + Advanced + Event-Driven): Intermediate Level Features: Priorities - High/Medium/Low priority levels on tasks Tags/Categories - Assign labels (work, home, personal) to tasks Search - Keyword search across title and description Filter - Filter by status, priority, tags, date range Sort - Sort by due date, priority, creation date, alphabetical Advanced Level Features: 6. Recurring Tasks - Auto-create next occurrence on completion (daily, weekly, monthly) 7. Due Dates - Set deadline with date/time picker 8. Reminders - Browser/email notifications before due date (via Dapr Jobs API) Event-Driven Architecture: Kafka Topics: task-events, reminders, task-updates Producer: Chat API/Backend (publishes all task operations) Consumers: Recurring Task Service, Notification Service, Audit Service Dapr Pub/Sub: Abstracts Kafka (can swap to RabbitMQ with config change) Cloud Deployment: Platform: Oracle Cloud OKE (always free) OR DigitalOcean DOKS ($200 trial) CI/CD: GitHub Actions (lint ‚Üí test ‚Üí build ‚Üí deploy) Monitoring: Prometheus + Grafana (optional bonus) Success Criteria (SMART): All 8 Intermediate + Advanced features implemented and working Recurring tasks auto-create next occurrence when marked complete Reminders trigger at scheduled time (via Dapr Jobs API, not cron polling) Priorities and tags visible in UI and filterable Search returns relevant results (tested with 10+ tasks) Filter by status/priority/tags working (UI dropdowns) Sort by date/priority/alphabetical working (UI buttons) Kafka topics created: task-events, reminders, task-updates At least 2 consumer services running (Recurring Task Service, Notification Service) Dapr sidecars running alongside all pods (visible in kubectl get pods) Dapr Pub/Sub component configured for Kafka Dapr Jobs API used for reminder scheduling (not cron) Cloud deployment functional on Oracle OKE OR DigitalOcean DOKS CI/CD pipeline working (GitHub Actions deploys on push to main) All Phase IV features still working in cloud deployment Tests covering advanced features (80%+ coverage) All code generated via Gemini CLI (prompt history documented) Technical Stack (from Constitution): Event Streaming: Kafka: Redpanda Cloud (free serverless) OR Strimzi (self-hosted on K8s) Topics: task-events, reminders, task-updates Consumer Groups: recurring-task-service, notification-service, audit-service Distributed Runtime: Dapr: v1.12+ with 5 building blocks Pub/Sub: Kafka abstraction State Management: Conversation state (alternative to DB queries) Jobs API: Scheduled reminders (replaces cron polling) Secrets: API keys and DB credentials Service Invocation: Inter-service communication Cloud Provider: Oracle Cloud OKE (always free, 4 OCPU, 24GB RAM) - RECOMMENDED OR DigitalOcean DOKS ($200 credit for 60 days) CI/CD: GitHub Actions Workflow: Lint ‚Üí Test ‚Üí Build Docker images ‚Üí Push to registry ‚Üí Deploy to K8s Database Schema (New Tables): Table: task_tags id: serial (primary key) task_id: integer (foreign key -> tasks.id, ON DELETE CASCADE) tag: string (not null) created_at: timestamp (default now) Table: task_recurrence id: serial (primary key) task_id: integer (foreign key -> tasks.id, ON DELETE CASCADE) pattern: enum('daily', 'weekly', 'monthly') (not null) next_due_date: timestamp (not null) created_at: timestamp (default now) Updated tasks table: Add columns: priority (enum: 'high', 'medium', 'low'), due_date (timestamp, nullable) Kafka Topics and Events: Topic: task-events (Producer: Backend) Event Schema: { "event_type": "created" | "updated" | "completed" | "deleted", "task_id": 123, "user_id": "uuid", "task_data": {...}, "timestamp": "2025-12-30T12:00:00Z" } Topic: reminders (Producer: Backend when due_date set) Event Schema: { "task_id": 123, "user_id": "uuid", "title": "Buy groceries", "due_at": "2025-12-31T18:00:00Z", "remind_at": "2025-12-31T17:00:00Z" } Topic: task-updates (Producer: Backend) Event Schema: { "event_type": "status_changed", "task_id": 123, "user_id": "uuid", "old_status": "pending", "new_status": "completed" } Microservices Architecture: Backend API (FastAPI) Handles REST API requests Publishes events to Kafka via Dapr Pub/Sub Uses Dapr Service Invocation to call MCP Server MCP Server (Python) Exposes todo operations as MCP tools Stateless (all state in DB or Dapr State) Recurring Task Service (Python) Consumes task-events topic When task with recurrence is completed, auto-creates next occurrence Uses Dapr State for tracking recurrence patterns Notification Service (Python) Consumes reminders topic Sends browser push notifications or emails Uses Dapr Secrets for email API keys Audit Service (Optional Bonus) Consumes task-events topic Writes audit log to database or file Tracks all user actions Dapr Components Configuration: Pub/Sub Component (Kafka): apiVersion: dapr.io/v1alpha1 kind: Component metadata: name: kafka-pubsub spec: type: pubsub.kafka version: v1 metadata: name: brokers value: "kafka:9092" # OR Redpanda Cloud URL name: consumerGroup value: "todo-service" State Store Component (PostgreSQL): apiVersion: dapr.io/v1alpha1 kind: Component metadata: name: statestore spec: type: state.postgresql version: v1 metadata: name: connectionString value: "host=neon.db user=... dbname=todo" Jobs API (Built-in, no component needed): Schedule reminder via HTTP POST to Dapr sidecar POST http://localhost:3500/v1.0-alpha1/jobs/reminder-task-{task_id} { "dueTime": "2025-12-31T17:00:00Z", "data": {"task_id": 123, "user_id": "uuid"} } Secrets Store (Kubernetes): apiVersion: dapr.io/v1alpha1 kind: Component metadata: name: kubernetes-secrets spec: type: secretstores.kubernetes version: v1 Dapr Usage Examples: Publish Event (Backend): import httpx await httpx.post( "http://localhost:3500/v1.0/publish/kafka-pubsub/task-events", json={"event_type": "created", "task_id": 1, "user_id": "..."} ) Subscribe to Event (Recurring Task Service): @app.post("/api/events/task-completed") async def handle_task_completed(event: dict): if event["task_data"].get("recurrence"): # Create next occurrence await create_next_task(event["task_data"]) Schedule Reminder (Backend): await httpx.post( f"http://localhost:3500/v1.0-alpha1/jobs/reminder-task-{task_id}", json={ "dueTime": remind_at.isoformat(), "data": {"task_id": task_id, "user_id": user_id} } ) Cloud Deployment (Oracle OKE): Create cluster via OCI Console (4 OCPU, 24GB RAM - always free) Configure kubectl oci ce cluster create-kubeconfig --cluster-id <cluster-id> Install Dapr on cluster dapr init -k Deploy Dapr components kubectl apply -f dapr-components/ Deploy app with Helm helm install todo-app ./hackathon-todo-chart -n production Check Dapr sidecars kubectl get pods -n production # Should show 2/2 (app + daprd) CI/CD Pipeline (GitHub Actions): .github/workflows/deploy.yml: name: Deploy to Cloud on: push: branches: [main] jobs: test: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Run Tests run: | cd backend && pytest cd ../frontend && npm test build-and-deploy: needs: test runs-on: ubuntu-latest steps: - name: Build Docker Images run: | docker build -t secrets.DOCKERUSERNAME/todo‚àífrontend:{{ secrets.DOCKER_USERNAME }}/todo-frontend: secrets.DOCKERU‚ÄãSERNAME/todo‚àífrontend:{{ github.sha }} ./frontend docker build -t secrets.DOCKERUSERNAME/todo‚àíbackend:{{ secrets.DOCKER_USERNAME }}/todo-backend: secrets.DOCKERU‚ÄãSERNAME/todo‚àíbackend:{{ github.sha }} ./backend - name: Push to Registry run: | docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }} docker push secrets.DOCKERUSERNAME/todo‚àífrontend:{{ secrets.DOCKER_USERNAME }}/todo-frontend: secrets.DOCKERU‚ÄãSERNAME/todo‚àífrontend:{{ github.sha }} docker push secrets.DOCKERUSERNAME/todo‚àíbackend:{{ secrets.DOCKER_USERNAME }}/todo-backend: secrets.DOCKERU‚ÄãSERNAME/todo‚àíbackend:{{ github.sha }} - name: Deploy to Kubernetes run: | kubectl set image deployment/todo-frontend frontend=secrets.DOCKERUSERNAME/todo‚àífrontend:{{ secrets.DOCKER_USERNAME }}/todo-frontend: secrets.DOCKERU‚ÄãSERNAME/todo‚àífrontend:{{ github.sha }} kubectl set image deployment/todo-backend backend=secrets.DOCKERUSERNAME/todo‚àíbackend:{{ secrets.DOCKER_USERNAME }}/todo-backend: secrets.DOCKERU‚ÄãSERNAME/todo‚àíbackend:{{ github.sha }} Quality Standards (from Constitution): Event-driven architecture (all services communicate via Kafka) Dapr abstracts infrastructure (no direct Kafka client in app code) Stateless services (all state in DB or Dapr State) Recurring tasks use Dapr Jobs API (not cron polling) All secrets via Dapr Secrets or K8s Secrets CI/CD pipeline deploys on every push to main Monitoring with Prometheus (optional bonus) All tests passing (80%+ coverage) User Scenarios: User creates recurring task (weekly) ‚Üí marks complete ‚Üí next week's task auto-created User sets due date on task ‚Üí reminder scheduled ‚Üí notification fires 1 hour before User assigns priority High to task ‚Üí task shows red badge in UI User adds tag "work" ‚Üí filters by "work" ‚Üí sees only work tasks User searches "groceries" ‚Üí sees all tasks with "groceries" in title/description User sorts by due date ‚Üí tasks ordered chronologically Developer pushes code to main ‚Üí GitHub Actions auto-deploys to cloud Edge Cases to Handle: Recurring task deleted before completion (cancel future occurrences) Reminder scheduled in the past (skip or fire immediately) Kafka broker unreachable (retry with exponential backoff) Dapr sidecar not running (return 503 Service Unavailable) Duplicate events (idempotency - handle same event twice gracefully) Database migration during deployment (use init container)

## Response snapshot

Created feature spec for Cloud Native Event Driven Deployment, covering advanced task features (priorities, tags, recurrence), event-driven architecture with Kafka/Dapr, and cloud deployment with CI/CD.

## Outcome

- ‚úÖ Impact: Feature formally specified with clear requirements and success criteria.
- üß™ Tests: N/A
- üìÅ Files: 2 files created.
- üîÅ Next prompts: /sp.clarify or /sp.plan
- üß† Reflection: Comprehensive spec capturing complex architectural requirements.

## Evaluation notes (flywheel)

- Failure modes observed: None
- Graders run and results (PASS/FAIL): PASS
- Prompt variant (if applicable): default
- Next experiment (smallest change to try): None